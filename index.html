<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Analysis</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/@turf/turf/turf.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
#map {
    height: 100vh;
    width: 100%;
}
// Create the map
var map = L.map('map').setView([31.9038, 35.2034], 13);

// Add tile layer to the map
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
}).addTo(map);

// Load GeoJSON files
var zones, police, civil, hospitals, pharmacies;

// Function to load GeoJSON files
function loadGeoJSON(url, callback) {
    fetch(url)
        .then(response => response.json())
        .then(data => callback(data));
}

// Function to analyze and determine new center locations
function findNewLocations(gdf, zonesGdf, minCenters = 3) {
    let newLocations = [];
    zonesGdf.features.forEach(zone => {
        let centersInZone = gdf.features.filter(feature => turf.booleanPointInPolygon(feature.geometry, zone.geometry));
        if (centersInZone.length < minCenters) {
            let newCentersNeeded = minCenters - centersInZone.length;
            for (let i = 0; i < newCentersNeeded; i++) {
                let centroid = turf.centroid(zone.geometry);
                newLocations.push({
                    type: 'Feature',
                    properties: {
                        zone: zone.properties.NAME
                    },
                    geometry: centroid.geometry
                });
            }
        }
    });
    return {
        type: 'FeatureCollection',
        features: newLocations
    };
}

// Load data, analyze it, and display it on the map
function processData() {
    loadGeoJSON('RamallahZones.geojson', function (data) {
        zones = data;
        loadGeoJSON('Police.geojson', function (data) {
            police = data;
            let newPoliceLocations = findNewLocations(police, zones);
            L.geoJSON(newPoliceLocations, { style: { color: 'blue' } }).addTo(map);
        });
        loadGeoJSON('ciivilld.geojson', function (data) {
            civil = data;
            let newCivilLocations = findNewLocations(civil, zones);
            L.geoJSON(newCivilLocations, { style: { color: 'yellow' } }).addTo(map);
        });
        loadGeoJSON('hospital.geojson', function (data) {
            hospitals = data;
            let newHospitalLocations = findNewLocations(hospitals, zones);
            L.geoJSON(newHospitalLocations, { style: { color: 'red' } }).addTo(map);
        });
        loadGeoJSON('pharmacy.geojson', function (data) {
            pharmacies = data;
            let newPharmacyLocations = findNewLocations(pharmacies, zones);
            L.geoJSON(newPharmacyLocations, { style: { color: 'green' } }).addTo(map);
        });
    });
}

processData();
